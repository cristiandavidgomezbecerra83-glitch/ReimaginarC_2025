<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Reimaginar_CE — Suspensiones & Revisión</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
:root{
  --bg:#f4f7f9; --card:#fff; --muted:#6b7280; --ink:#0f172a;
  --accent:#F28C00; --success:#10b981; --danger:#ef4444;
  --shadow:0 6px 18px rgba(16,24,40,.08); --radius:12px;
  font-family:"Inter", system-ui, -apple-system, 'Segoe UI', Roboto, Arial;
}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg) 0%, #eef6f5 100%);}
header{display:flex;align-items:center;gap:15px;padding:10px 20px;border-bottom:4px solid var(--accent);background:#fff;box-shadow:var(--shadow);}
header img{height:70px}
header h2{margin:0;color:#0f172a;font-weight:700;font-size:22px}
header p{margin:0;color:#6b7280;font-size:.9em}
header .right{margin-left:auto;text-align:right}
.pill{background:var(--accent);color:#fff;display:inline-block;padding:10px 18px;border-radius:24px;font-size:1em;font-weight:600;box-shadow:0 4px 10px rgba(242,140,0,.3)}

.tabs{display:flex;gap:10px;padding:10px 20px;border-bottom:1px solid #e5e7eb;background:#fff}
.tabbtn{padding:10px 16px;border:1px solid #e5e7eb;border-radius:10px;background:#fff;cursor:pointer;font-size:14px;font-weight:600;color:#334155;transition:all .2s ease}
.tabbtn:hover{background:#f9fafb}
.tabbtn.active{background:var(--accent);color:#fff;border-color:var(--accent)}

.page{display:none}
.page.active{display:block}
.layout{display:grid;grid-template-columns:370px 1fr;gap:20px;padding:20px}
.sidebar{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);height:calc(100vh - 180px);overflow:auto}
.card{background:var(--card);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)}
label{font-size:13px;color:var(--muted);font-weight:500}
select,button,input{padding:9px 10px;border-radius:8px;border:1px solid #e6eef0;font-size:13px;width:100%}
button{cursor:pointer;background:var(--accent);color:#fff;font-weight:600;border:none}
button:hover{opacity:.9}

.row-main{display:flex;gap:20px;align-items:stretch}
.table-wrap,.chart-bar-wrap{flex:1;display:flex;flex-direction:column;background:#fff;border-radius:var(--radius);padding:14px;box-shadow:var(--shadow)}
.table-scroll{flex:1;overflow:auto;}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{padding:8px;border-bottom:1px solid #f2f6f7;text-align:left}
th{color:#6b7280;font-weight:600}
.chart-bar-wrap canvas{flex:1;width:100%!important;height:340px!important}

.kpi-box{background:linear-gradient(135deg,#fff,#f9fafb);border-left:5px solid var(--accent);padding:10px 14px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;box-shadow:var(--shadow);}
.kpi-label{color:#6b7280;font-size:13px}
.kpi-value{font-weight:700;font-size:15px;color:#0f172a}
.kpi-green .kpi-value{color:var(--success)}
.kpi-gray .kpi-value{color:#475569}
footer{padding:18px;color:#6b7280;font-size:13px;text-align:center}
@media(max-width:1200px){.layout{grid-template-columns:1fr}.row-main{flex-direction:column}}
</style>
</head>
<body>
<header>
  <img src="https://raw.githubusercontent.com/cristiandavidgomezbecerra83-glitch/ReimaginarC/main/logo-celsia.png" alt="Logo Celsia">
  <div>
    <h2>Reimaginar_CE — Tablero Gerencial</h2>
    <p>Monitoreo de Suspensiones y Cobros de Revisión</p>
  </div>
  <div class="right">
    <div class="pill" id="acumuladoTotal">$ 0 mill. · Acumulado</div>
    <small id="lastUpdated" style="display:block;color:#6b7280;font-size:12px;margin-top:6px;">Actualizado: --</small>
  </div>
</header>

<div class="tabs">
  <button class="tabbtn active" data-tab="page1">Suspensiones</button>
  <button class="tabbtn" data-tab="page2">Revision</button>
</div>

<section id="page1" class="page active">
  <div class="layout">
    <aside class="sidebar">
      <div class="card">
        <h3 style="margin-top:0;color:#0f172a;font-weight:700">Resumen Ahorro</h3>
        <div style="margin-bottom:14px;color:#6b7280;font-size:13px">
          <small>Monitoreo de suspensiones por región, sector y mes.</small>
        </div>
        <div class="filters">
          <div><label>Región</label><select id="filterRegion"><option value="ALL">Todos</option></select></div>
          <div><label>Sector / Zona</label><select id="filterSector" disabled><option value="ALL">Todos</option></select></div>
          <div><label>Mes</label><select id="filterMes"><option value="ALL">Todos</option></select></div>
          <div class="toolbar" style="margin-top:10px"><button id="btnReset">Limpiar filtros</button></div>
        </div>

        <div style="margin-top:18px;border-top:1px solid #e5e7eb;padding-top:14px;display:grid;gap:12px">
          <div class="kpi-box">
            <span class="kpi-label">Valor proyectado</span>
            <input type="number" id="inputValorProy" value="840000000" min="0" step="1000000" style="width:120px;text-align:right;font-weight:700;color:#0f172a;border:1px solid #e5e7eb;border-radius:6px;padding:4px 6px;">
          </div>
          <div class="kpi-box kpi-green"><span class="kpi-label">Total actual</span><span id="kpiTotalActual" class="kpi-value">$ 0</span></div>
          <div class="kpi-box kpi-gray"><span class="kpi-label">Faltante</span><span id="kpiFaltante" class="kpi-value">$ 0</span></div>
          <div class="kpi-box"><span class="kpi-label">Promedio por mes</span><span id="kpiPromMes2" class="kpi-value">$ 0</span></div>
        </div>
      </div>
    </aside>

    <main>
      <section id="panelGlobal">
        <div class="row-main">
          <div class="table-wrap">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
              <h3 style="margin:0;color:#0f172a">Tabla resumen</h3><small style="color:#6b7280"><span id="rowsCount">0</span> registros</small>
            </div>
            <div class="table-scroll">
              <table id="tablaResumen">
                <thead><tr><th>Región</th><th>Sector</th><th>Mes</th><th>Cant</th><th>Ahorro</th></tr></thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
          <div class="chart-bar-wrap">
            <h3 style="margin:6px;color:#0f172a;font-size:15px;font-weight:600">Ahorro por sector</h3>
            <canvas id="chartBarras"></canvas>
          </div>
        </div>
      </section>
    </main>
  </div>
</section>

<section id="page2" class="page">
  <div class="layout" style="grid-template-columns:1fr">
    <div class="card" style="text-align:center;background:#fff5ec;border-left:5px solid var(--accent);font-weight:700;">INFORMACIÓN PROYECTO REIMAGINAR_CE — COBRO DE REVISIÓN EN CAMBIOS DE MEDIDOR</div>
    <div class="row-main" style="margin-top:10px;flex-direction:column;gap:20px;">
      <div class="row-main" style="gap:18px">
        <div class="card" style="flex:1">
          <h4 style="margin:4px 0 8px 0;color:#0f172a">KPIs Principales</h4>
          <div class="kpi-box"><span class="kpi-label">Valor proyectado</span><span id="revKpiProy" class="kpi-value">$ 0</span></div>
          <div class="kpi-box kpi-green"><span class="kpi-label">Total actual</span><span id="revKpiActual" class="kpi-value">$ 0</span></div>
          <div class="kpi-box kpi-gray"><span class="kpi-label">Faltante</span><span id="revKpiFaltante" class="kpi-value">$ 0</span></div>
          <div class="kpi-box"><span class="kpi-label">Promedio por mes</span><span id="revKpiPromMes" class="kpi-value">$ 0</span></div>
        </div>
        <div class="chart-bar-wrap" style="flex:1">
          <h4 style="margin:4px 0 10px 0;color:#0f172a">Porcentaje de Avance por Departamento</h4>
          <canvas id="revBarPct"></canvas>
        </div>
      </div>
      <div class="table-wrap">
        <h4 style="margin:0 0 8px 0;color:#0f172a">Resumen mensual</h4>
        <div class="table-scroll">
          <table id="revTabla">
            <thead><tr><th>DEPARTAMENTO</th><th>Febrero</th><th>Marzo</th><th>Abril</th><th>Mayo</th><th>Junio</th><th>Julio</th></tr></thead>
            <tbody></tbody><tfoot></tfoot>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>

<footer>© 2025 · Celsia · Tablero Reimaginar_CE · Visión Gerencial ⚡</footer>

<script>
const datos=[
  {REGION:'VALLE',SECTOR:'CENTRO',MES:'abril',CANT:200,AHORRO:15000000},
  {REGION:'VALLE',SECTOR:'NORTE',MES:'abril',CANT:300,AHORRO:18000000},
  {REGION:'VALLE',SECTOR:'PACIFICO',MES:'mayo',CANT:400,AHORRO:25000000},
  {REGION:'VALLE',SECTOR:'SUR',MES:'junio',CANT:350,AHORRO:18000000},
  {REGION:'TOLIMA',SECTOR:'Zona Centro',MES:'abril',CANT:150,AHORRO:8000000},
  {REGION:'TOLIMA',SECTOR:'Zona Norte',MES:'mayo',CANT:200,AHORRO:11000000},
  {REGION:'TOLIMA',SECTOR:'Zona Sur',MES:'junio',CANT:130,AHORRO:13000000},
  {REGION:'TOLIMA',SECTOR:'Zona Oriente',MES:'julio',CANT:180,AHORRO:6000000},
];

const MESES_ORD=['enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre'];
const fmtMoney=n=>'$ '+Number(n||0).toLocaleString('es-CO');
const uniq=(arr,key)=>[...new Set(arr.map(x=>x[key]).filter(Boolean))];
const cap=s=>(s||'').charAt(0).toUpperCase()+String(s).slice(1).toLowerCase();
let charts={};

// === LOCALSTORAGE ===
const KEY_PROY='valorProyectado';
function getValorProyectado(){return Number(localStorage.getItem(KEY_PROY))||840000000;}
function setValorProyectado(v){localStorage.setItem(KEY_PROY,v);}

document.querySelectorAll('.tabbtn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tabbtn').forEach(b=>b.classList.remove('active'));
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.add('active');
    if(btn.dataset.tab==='page1'){render();} else {renderRevision();}
  });
});

function sectoresPorRegion(r){return r==='VALLE'?['CENTRO','NORTE','PACIFICO','SUR']:['Zona Centro','Zona Norte','Zona Sur','Zona Oriente'];}
function poblarFiltrosIniciales(){
  const regSel=document.getElementById('filterRegion');
  uniq(datos,'REGION').forEach(r=>{const o=document.createElement('option');o.value=r;o.textContent=r;regSel.appendChild(o);});
  actualizarMeses('ALL');actualizarSectores('ALL');
}
function actualizarSectores(region){
  const sel=document.getElementById('filterSector');
  const disabled=(region==='ALL');sel.disabled=disabled;
  let ops=[];
  if(region==='VALLE')ops=['CENTRO','NORTE','PACIFICO','SUR'];
  if(region==='TOLIMA')ops=['Zona Centro','Zona Norte','Zona Sur','Zona Oriente'];
  sel.innerHTML='<option value="ALL">Todos</option>'+ops.map(s=>`<option>${s}</option>`).join('');
  sel.value='ALL';
}
function actualizarMeses(region){
  const mesSel=document.getElementById('filterMes');
  let fuente=datos;if(region!=='ALL')fuente=datos.filter(d=>d.REGION===region);
  const meses=uniq(fuente,'MES').sort((a,b)=>MESES_ORD.indexOf(a)-MESES_ORD.indexOf(b));
  mesSel.innerHTML='<option value="ALL">Todos</option>'+meses.map(m=>`<option value="${m}">${cap(m)}</option>`).join('');
}
function filtrarBase(region){
  const sector=document.getElementById('filterSector').value;
  const mes=document.getElementById('filterMes').value;
  return datos.filter(d=>{
    if(region!=='ALL'&&d.REGION!==region)return false;
    if(sector!=='ALL'&&d.SECTOR!==sector)return false;
    if(mes!=='ALL'&&d.MES!==mes)return false;
    return true;
  });
}
function render(){
  const region=document.getElementById('filterRegion').value;
  const list=filtrarBase(region);
  renderTabla('#tablaResumen tbody','#rowsCount',list,false,region);
  renderBars('chartBarras',list,region);
  renderKPIsAhorro();
}

function renderBars(id,list,region){
  if(charts[id]){charts[id].destroy();charts[id]=null;}
  const canvas=document.getElementById(id);
  canvas.style.height='340px';canvas.style.width='100%';
  const sectRef=region?sectoresPorRegion(region):uniq(list,'SECTOR');
  const byS={};sectRef.forEach(s=>byS[s]=0);
  list.forEach(r=>{byS[r.SECTOR]=(byS[r.SECTOR]||0)+(r.AHORRO||0);});
  const labels=Object.keys(byS);const values=labels.map(l=>byS[l]);
  requestAnimationFrame(()=>{charts[id]=new Chart(canvas,{
    type:'bar',
    data:{labels,datasets:[{data:values,backgroundColor:'rgba(242,140,0,0.85)',borderColor:'rgba(242,140,0,1)',borderWidth:1.2,borderRadius:10,barThickness:30}]},
    options:{responsive:true,maintainAspectRatio:false,animation:{duration:700,easing:'easeOutQuart'},
      plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>fmtMoney(c.raw)}}},
      scales:{y:{beginAtZero:true,grid:{color:'rgba(148,163,184,.15)'},ticks:{callback:v=>fmtMoney(v)}}}}
  });});
}

function renderKPIsAhorro(){
  const total=datos.reduce((a,b)=>a+(b.AHORRO||0),0);
  const proy=getValorProyectado();
  const falt=Math.max(proy-total,0);
  const meses=uniq(datos,'MES').length||1;
  const promMes=Math.round(total/meses);
  document.getElementById('acumuladoTotal').textContent=fmtMoney(total)+' · Acumulado';
  document.getElementById('kpiTotalActual').textContent=fmtMoney(total);
  document.getElementById('kpiFaltante').textContent=fmtMoney(falt);
  document.getElementById('kpiPromMes2').textContent=fmtMoney(promMes);
}

document.getElementById('inputValorProy').addEventListener('input',e=>{
  const val=Number(e.target.value)||0;
  setValorProyectado(val);
  renderKPIsAhorro();
});

function renderRevision(){
  if(charts['revBarPct']){charts['revBarPct'].destroy();charts['revBarPct']=null;}
  const total=datos.reduce((a,b)=>a+(b.AHORRO||0),0);
  const valle=datos.filter(d=>d.REGION==='VALLE').reduce((a,b)=>a+(b.AHORRO||0),0);
  const tolima=datos.filter(d=>d.REGION==='TOLIMA').reduce((a,b)=>a+(b.AHORRO||0),0);
  const metaTotal=getValorProyectado(),metaValle=340000000,metaTolima=500000000;
  const falt=Math.max(metaTotal-total,0);
  const meses=uniq(datos,'MES').length||1;
  const promMes=Math.round(total/meses);
  document.getElementById('revKpiProy').textContent=fmtMoney(metaTotal);
  document.getElementById('revKpiActual').textContent=fmtMoney(total);
  document.getElementById('revKpiFaltante').textContent=fmtMoney(falt);
  document.getElementById('revKpiPromMes').textContent=fmtMoney(promMes);
  charts['revBarPct']=new Chart(document.getElementById('revBarPct'),{
    type:'bar',
    data:{labels:['TOLIMA','VALLE'],datasets:[{data:[(tolima/metaTolima*100),(valle/metaValle*100)],backgroundColor:['#0ea5a5','#22c55e'],borderRadius:10,barThickness:28}]},
    options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,
      plugins:{legend:{display:false},tooltip:{callbacks:{label:c=>c.raw.toFixed(1)+' %'}}},
      scales:{x:{beginAtZero:true,max:100,ticks:{callback:v=>v+' %'},grid:{color:'rgba(203,213,225,.4)'}},y:{grid:{display:false}}}}
  });
}

function init(){
  document.getElementById('lastUpdated').textContent='Actualizado: '+(new Date()).toLocaleString();
  document.getElementById('inputValorProy').value=getValorProyectado();
  poblarFiltrosIniciales();
  document.getElementById('filterRegion').addEventListener('change',e=>{actualizarSectores(e.target.value);actualizarMeses(e.target.value);render();});
  document.getElementById('filterSector').addEventListener('change',render);
  document.getElementById('filterMes').addEventListener('change',render);
  document.getElementById('btnReset').addEventListener('click',()=>{document.getElementById('filterRegion').value='ALL';actualizarSectores('ALL');actualizarMeses('ALL');render();});
  render();renderRevision();
}
window.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
